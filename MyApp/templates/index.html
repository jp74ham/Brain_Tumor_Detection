<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/globals.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styleguide.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}" />
  </head>
  <body>
    <main class="front" data-model-id="7:895">
      <div class="component">
        <header class="hero-basic">
          <div class="text-content-title">
            <h1 class="title">Brain Tumor MRI Detection and Classification</h1>
            <p class="subtitle">DS5110 Final Project<br />Sri Divija Enturi, Reha Jambavadekar, Jessica Pham</p>
          </div>
          <div class="header-buttons">
            <button id="patient-login-btn" class="patient-login-button">Patient Login</button>
            <button id="admin-login-btn" class="admin-login-button">Database Login</button>
          </div>
        </header>
        <h2 class="text-wrapper-3">Schema and ER diagram</h2>
        <section class="panel-image-content">
          <div class="image" role="img" aria-label="ER Diagram">
            <img src="{{ url_for('static', filename='images/ERD.drawio.png') }}" alt="ER Diagram" style="max-width:100%;height:auto;display:block;margin:0 auto;" />
          </div>
          <div class="text-content-flow">
            <p class="text-wrapper-4">Key Relationships</p>
            <div class="text">
              <p class="p">
                <ul class="etl-list">
                  <li>One Patient → can have many MRI scans</li>
                  <li>One MRI scan → one Classification result</li>
                  <li> Admins, Radiologists, Patients are subclasses of Users</li>
                </ul>
              </p>
            </div>
            <p class="text-wrapper-4">Design → Execution</p>
            <div class="text">
              <p class="p">
                <ul class="etl-list">
                  <li>Tables: Users (consolidated subclasses), mri_scans, tumor_classification</li>
                  <li>mari_scans + extra attributes for metadata</li>
                  <li>Relationship changed for simplicity: One Patient → one MRI scan</li>
                </ul>
              </p>
            </div>
            <details class="accordion-item">
              <summary class="accordion-title">
                <span class="text-wrapper-2">Final Database Schema</span>
                <img class="img" src="https://c.animaapp.com/DnqGvymX/img/chevron-down-13.svg" alt="" aria-hidden="true" />
              </summary>
              <div class="accordion-content">
                <div class="schema-block">
                  <h4 class="text-wrapper-2">mri_scans</h4>
                  <pre class="query-code">CREATE TABLE "mri_scans" (
"original_path" TEXT,
  "processed_path" TEXT,
  "label" TEXT,
  "orig_width" INTEGER,
  "orig_height" INTEGER,
  "proc_width" INTEGER,
  "proc_height" INTEGER,
  "mean_pixel" REAL,
  "std_pixel" REAL,
  "ingest_timestamp" TEXT,
  "patient_id" INTEGER,
  "age" INTEGER,
  "gender" TEXT,
  "hospital_unit" TEXT,
  "scan_date" TEXT
)</pre>

                  <h4 class="text-wrapper-2">tumor_classification</h4>
                  <pre class="query-code">CREATE TABLE tumor_classification (
    classification_id INTEGER PRIMARY KEY AUTOINCREMENT,
    processed_path TEXT,
    predicted_label TEXT,
    confidence FLOAT,
    model_name TEXT,
    classified_on TEXT
)</pre>

                  <h4 class="text-wrapper-2">users</h4>
                  <pre class="query-code">CREATE TABLE users (
        username TEXT PRIMARY KEY,
        password_hash TEXT NOT NULL,
        password_salt TEXT NOT NULL,
        iterations INTEGER NOT NULL,
        role TEXT NOT NULL,
        patient_id INTEGER,
        created_on TEXT NOT NULL
    )</pre>
                </div>
              </div>
            </details>
          </div>
        </section>
        <section class="page-accordion">
          <div class="text-content-heading">
            <h2 class="text-wrapper">Project Information</h2>
          </div>
          <div class="accordion" role="region" aria-label="Project Information">
            <details class="accordion-item" open>
              <summary class="accordion-title">
                <span class="text-wrapper-2">Dataset and Links</span>
                <img class="img" src="https://c.animaapp.com/DnqGvymX/img/chevron-up-4.svg" alt="" aria-hidden="true" />
              </summary>
              <div class="accordion-content">
                <ul class="etl-list">
                  <li>Sourced from <a href="https://www.kaggle.com/datasets/sartajbhuvaji/brain-tumor-classification-mri" target="_blank" rel="noopener noreferrer">Kaggle</a> (Bhuvaji et al.)</li>
                  <li>4 tumor classes: glioma, meningioma, pituitary, no_tumor</li>
                  <li>Contains ~3,000+ MRI images</li>
                  <li>Organized in labeled directories</li>
                  <li><a href="https://github.com/jp74ham/Brain_Tumor_Detection" target="_blank" rel="noopener noreferrer">Project Github</a></li>
                </ul>
              </div>
            </details>
            <details class="accordion-item" open>
              <summary class="accordion-title">
                <span class="text-wrapper-2">Tools and Technologies </span>
                <img class="img" src="https://c.animaapp.com/DnqGvymX/img/chevron-up-4.svg" alt="" aria-hidden="true" />
              </summary>
              <div class="accordion-content">
                <p class="body">
                  <ul class="etl-list">
                  <li>Python, Pandas, NumPy, OpenCV — preprocessing</li>
                  <li>TensorFlow / Keras — model training</li>
                  <li>SQLite / SQLAlchemy — structured storage</li>
                  <li>Flask — web framework</li>
                  <li>Matplotlib — visualizations</li>
                </ul>
                </p>
              </div>
            </details>
            <details class="accordion-item" open>
              <summary class="accordion-title">
                <span class="text-wrapper-2">ETL Pipeline</span>
                <img class="img" src="https://c.animaapp.com/DnqGvymX/img/chevron-up-4.svg" alt="" aria-hidden="true" />
              </summary>
              <div class="accordion-content">
                <ul class="etl-list">
                  <li>Extract: MRI images from the Kaggle dataset were unzipped and organized by tumor type.</li>
                  <li>Transform: Preprocessed images - resized to 224x224, normalized pixel values, and extracted metadata, saved processed images</li>
                  <li>Load: Metadata with additional synthetic fields (age, gender, scan date, hospital unit), stored in SQLite database</li>
                  <li>Created relational links between patients, scans, and classifications with proper foreign key constraints</li>
                </ul>
              </div>
            </details>
            <details class="accordion-item">
              <summary class="accordion-title">
                <span class="text-wrapper-2">Queries (click result images to enlarge) </span>
                <img
                  class="img"
                  src="https://c.animaapp.com/DnqGvymX/img/chevron-down-13.svg"
                  alt=""
                  aria-hidden="true"
                />
              </summary>
              <div class="accordion-content">
                <div class="query-results-grid">
                  <!-- Query 1: Tumor Distribution -->
                  <div class="query-pair">
                    <div class="query-code-container">
                      <p class="query-label">Query 1: Total cases by tumor type</p>
                      <pre class="query-code">SELECT label AS tumor_type,
       COUNT(*) AS total_cases
FROM mri_scans
GROUP BY label
ORDER BY total_cases DESC;</pre>
                    </div>
                    <div class="query-image-container">
                      <img src="{{ url_for('static', filename='images/query1_result.png') }}" alt="Query 1 Result" class="query-image">
                      <p class="query-label">Query Result</p>
                    </div>
                  </div>
                  <!-- Query 2: Age Demographics -->
                  <div class="query-pair">
                    <div class="query-code-container">
                      <p class="query-label">Query 2: Age group analysis with average image area</p>
                      <pre class="query-code">SELECT
    CASE
        WHEN age BETWEEN 20 AND 29 THEN '20s'
        WHEN age BETWEEN 30 AND 39 THEN '30s'
        WHEN age BETWEEN 40 AND 49 THEN '40s'
        WHEN age BETWEEN 50 AND 59 THEN '50s'
        WHEN age BETWEEN 60 AND 69 THEN '60s'
        ELSE '70s+'
    END AS age_group,
    label,
    AVG(orig_width * orig_height) AS avg_area,
    COUNT(*) AS cases
FROM mri_scans
GROUP BY age_group, label
ORDER BY age_group;</pre>
                    </div>
                    <div class="query-image-container">
                      <img src="{{ url_for('static', filename='images/query2_result.png') }}" alt="Query 2 Result" class="query-image">
                      <p class="query-label">Query Result</p>
                    </div>
                  </div>
                  <!-- Query 3: Hospital Unit Distribution -->
                  <div class="query-pair">
                    <div class="query-code-container">
                      <p class="query-label">Query 3: Cases by hospital unit and tumor type</p>
                      <pre class="query-code">SELECT hospital_unit,
       label AS tumor_type,
       COUNT(*) AS cases
FROM mri_scans
GROUP BY hospital_unit, label
ORDER BY hospital_unit, cases DESC;</pre>
                    </div>
                    <div class="query-image-container">
                      <img src="{{ url_for('static', filename='images/query3_result.png') }}" alt="Query 3 Result" class="query-image">
                      <p class="query-label">Query Result</p>
                    </div>
                  </div>
                  <!-- Query 4: Gender Distribution -->
                  <div class="query-pair">
                    <div class="query-code-container">
                      <p class="query-label">Query 4: Total cases by gender and tumor type</p>
                      <pre class="query-code">SELECT gender, label AS tumor_type, COUNT(*) AS total
FROM mri_scans
GROUP BY gender, tumor_type
ORDER BY gender;</pre>
                    </div>
                    <div class="query-image-container">
                      <img src="{{ url_for('static', filename='images/query4_result.png') }}" alt="Query 4 Result" class="query-image">
                      <p class="query-label">Query Result</p>
                    </div>
                  </div>
                  <!-- Query 5: Glioma Cases -->
                  <div class="query-pair">
                    <div class="query-code-container">
                      <p class="query-label">Query 5: Glioma tumor cases for patients over 50</p>
                      <pre class="query-code">SELECT processed_path, age, gender, hospital_unit
FROM mri_scans
WHERE label = 'glioma_tumor'
  AND age > 50
LIMIT 100;</pre>
                    </div>
                    <div class="query-image-container">
                      <img src="{{ url_for('static', filename='images/query5_result.png') }}" alt="Query 5 Result" class="query-image">
                      <p class="query-label">Query Result</p>
                    </div>
                  </div>
                  <!-- Query 6: Weekly Trends -->
                  <div class="query-pair">
                    <div class="query-code-container">
                      <p class="query-label">Query 6: Weekly case trends by tumor type</p>
                      <pre class="query-code">SELECT
    STRFTIME('%Y-%W', scan_date) AS week,
    label AS tumor_type,
    COUNT(*) AS cases
FROM mri_scans
GROUP BY week, tumor_type
ORDER BY week;</pre>
                    </div>
                    <div class="query-image-container">
                      <img src="{{ url_for('static', filename='images/query6_result.png') }}" alt="Query 6 Result" class="query-image">
                      <p class="query-label">Query Result</p>
                    </div>
                  </div>
                  <!-- Query 7: Specific Tumor Cases -->
                  <div class="query-pair">
                    <div class="query-code-container">
                      <p class="query-label">Query 7: MRI scans for specific tumor types with patient info</p>
                      <pre class="query-code">SELECT
    ms.scan_id,
    p.anonymized_id,
    p.age,
    p.gender,
    ms.image_path,
    tc.tumor_type,
    tc.confidence_score,
    p.hospital_name
FROM MRI_Scans ms
JOIN Patients p ON ms.patient_id = p.patient_id
JOIN Tumor_Classification tc ON ms.scan_id = tc.scan_id
WHERE tc.tumor_type = 'glioma'
ORDER BY tc.confidence_score DESC
LIMIT 10;</pre>
                    </div>
                    <div class="query-image-container">
                      <img src="{{ url_for('static', filename='images/query7_result.png') }}" alt="Query 7 Result" class="query-image">
                      <p class="query-label">Query Result</p>
                    </div>
                  </div>
                  <!-- Query 8: Hospital Performance -->
                  <div class="query-pair">
                    <div class="query-code-container">
                      <p class="query-label">Query 8: Hospital performance statistics</p>
                      <pre class="query-code">SELECT
    p.hospital_name,
    COUNT(DISTINCT p.patient_id) as total_patients,
    COUNT(ms.scan_id) as total_scans,
    SUM(CASE WHEN tc.tumor_type != 'no_tumor' 
        THEN 1 ELSE 0 END) as tumor_detections,
    ROUND(SUM(CASE WHEN tc.tumor_type != 'no_tumor' 
        THEN 1 ELSE 0 END) * 100.0 /
        COUNT(ms.scan_id), 2) as detection_rate
FROM Patients p
JOIN MRI_Scans ms ON p.patient_id = ms.patient_id
JOIN Tumor_Classification tc ON ms.scan_id = tc.scan_id
GROUP BY p.hospital_name
ORDER BY total_scans DESC;</pre>
                    </div>
                    <div class="query-image-container">
                      <img src="{{ url_for('static', filename='images/query8_result.png') }}" alt="Query 8 Result" class="query-image">
                      <p class="query-label">Query Result</p>
                    </div>
                  </div>
                  <!-- Query 9: Recent Scans -->
                  <div class="query-pair query-pair-single">
                    <div class="query-code-container">
                      <p class="query-label">Query 9: Most recent scans by tumor type</p>
                      <pre class="query-code">SELECT
    tc.tumor_type,
    COUNT(*) as recent_count,
    MAX(ms.upload_timestamp) as latest_scan
FROM Tumor_Classification tc
JOIN MRI_Scans ms ON tc.scan_id = ms.scan_id
WHERE ms.upload_timestamp >= date('now', '-30 days')
GROUP BY tc.tumor_type
ORDER BY recent_count DESC;</pre>
                    </div>
                    <div class="query-image-container">
                      <img src="{{ url_for('static', filename='images/query9_result.png') }}" alt="Query 9 Result" class="query-image">
                      <p class="query-label">Query Result</p>
                    </div>
                  </div>
                </div>
              </div>
            </details>
            <details class="accordion-item">
              <summary class="accordion-title">
                <span class="text-wrapper-2">Training and Testing Results</span>
                <img
                  class="img"
                  src="https://c.animaapp.com/DnqGvymX/img/chevron-down-13.svg"
                  alt=""
                  aria-hidden="true"
                />
              </summary>
              <div class="accordion-content">
                <p class="body">
                  Answer the frequently asked question in a simple sentence, a longish paragraph, or even in a list.
                </p>
              </div>
            </details>
          </div>
        </section>
        <section class="frame">
          <div class="frame-2">
            <article class="upload-file">
              <header class="header"><h2 class="title-2">Download a random MRI scan and try our model</h2></header>
              <div class="content">
                <form
                  id="upload-form"
                  class="component-upload"
                  method="post"
                  enctype="multipart/form-data"
                  aria-label="MRI Image Upload Form"
                >
                  <div class="frame-3">
                    <img
                      id="preview-image"
                      class="component-2"
                      src="https://c.animaapp.com/DnqGvymX/img/component-placeholder-image-2@2x.png"
                      alt="MRI image placeholder"
                    />
                    <div class="frame-4">
                      <label for="mri-upload" class="please-upload-square">Upload a MRI Brain Image</label>
                      <div class="component-upload-2">
                        <div class="component-button">
                          <label for="mri-upload" class="frame-5">
                            <span class="text-wrapper-5">Choose File</span>
                          </label>
                          <input
                            type="file"
                            id="mri-upload"
                            name="mri-upload"
                            accept="image/*"
                            aria-describedby="file-chosen"
                            hidden
                          />
                        </div>
                        <div class="component-chosen">
                          <span class="text-wrapper-6" id="file-chosen" aria-live="polite">No File Chosen</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="component-button-wrapper">
                    <button type="button" id="save-btn" class="frame-wrapper" aria-label="Save uploaded image" disabled>
                      <span class="frame-5"><span class="choose-file">Save</span></span>
                    </button>
                  </div>
                </form>
                <!-- <hr class="divider-line" aria-hidden="true" /> -->
                <div class="sample-file-cta">
                  <a href="#" target="_blank" rel="noopener noreferrer" aria-label="Download Random MRI Image">
                    <div class="download">
                      <img class="icon" src="https://c.animaapp.com/DnqGvymX/img/icon-1.png" alt="Download icon" />
                    </div>
                  </a>
                  <span class="text-wrapper-7">Download Random MRI Image</span>
                </div>
              </div>
              <footer class="button">
                <button type="button" id="cancel-btn" class="secondary-button" aria-label="Cancel operation">
                  <span class="label">Cancel</span>
                </button>
                <button type="button" id="submit-btn" class="primary-button" aria-label="Submit MRI image for classification" disabled>
                  <span class="label-2">Submit</span>
                </button>
              </footer>
            </article>
            <aside class="product-info-card" aria-label="Classification Results">
              <div id="result-image" class="image-2" role="img" aria-label="Result visualization"></div>
              <div class="body-2">
                <div class="div-wrapper"><h3 class="text-wrapper-8">Results</h3></div>
                <div class="text-strong"><span class="text-wrapper-9">Tumor?</span></div>
                <div class="div-wrapper"><output id="tumor-result" class="text-wrapper-10" aria-live="polite">-</output></div>
                <div class="text-strong-2"><span class="text-wrapper-11">Type?</span></div>
                <div class="text-small">
                  <output id="type-result" class="text-wrapper-12" aria-live="polite">-</output>
                </div>
              </div>
            </aside>
          </div>
        </section>
        <footer class="footer-wrapper">
          <div class="footer">
            <p style="text-align: center; padding: 20px; color: var(--color-text-default-secondary);">
              © 2025 DS5110: Essentials of Data Science - Final Project - Dr. Fatema Nafa
            </p>
          </div>
        </footer>
      </div>
    </main>
    <script src="{{ url_for('static', filename='css/script.js') }}"></script>
  </body>
</html>
